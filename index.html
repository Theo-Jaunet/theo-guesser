<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Basic Page Needs
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta charset="utf-8">
    <title>Projection</title>
    <meta name="description" content="">
    <meta name="author" content="Theo Jaunet, Romain Vuillemot, and Christian Wolf">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <!-- Mobile Specific Metas
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- FONT
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

    <!-- CSS
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/css/skeleton.css">

    <!-- Favicon
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="icon" type="image/png" href="assets/images/favicon/favicon.ico">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="assets/js/projector.js"></script>
    <script src="assets/js/local.js"></script>
</head>
<body>

<!-- Primary Page Layout
–––––––––––––––––––––––––––––––––––––––––––––––––– -->
<div class="container" style="margin-bottom: 5%; width: 1100px;max-width: 1100px">
    <div class="row">
        <div class="twelve column" style="margin-top: 10%">
            <h4 style="text-align: center"> VisXAi2 </h4>
        </div>
    </div>


    <div class="row">
        <div class="twelve column" style="margin-top: 10%">
            <h4 style="text-align: left"> Intro </h4>
            <p>
                Of the Beginning of Days It is told among the wise that the First War began before Arda was full-shaped,
                and ere yet there was any thing that grew or walked upon earth; and for long Melkor had the upper hand.
                But in the midst of the war a spirit of great strength and hardihood came to the aid of the Valar,
                hearing in the far heaven that there was battle in the Little Kingdom; and Arda was filled with the
                sound of his laughter. So came Tulkas the Strong, whose anger passes like a mighty wind, scattering
                cloud and darkness before it; and Melkor fled before his wrath and his laughter, and forsook Arda, and
                there was peace for a long age. And Tulkas remained and became one of the Valar of the Kingdom of Arda;
                but Melkor brooded in the outer darkness, and his hate was given to Tulkas for ever after.
            </p>
        </div>

    </div>


    <div class="row">
        <div class="six columns" style="margin-top: 10%">
            <svg id="proj" style="width: 100%;height: 530px;border: #555555 solid 1px"></svg>
        </div>
        <div class="six columns" style="margin-top: 10%">
            <svg id="loc" style="width: 100%;height: 530px;border: #555555 solid 1px"></svg>
        </div>
    </div>


    <div class="row" style="text-align: center">
        <div class="twelve columns" style="margin-top: 2%;display: inline-block">
            <div style=" text-align: left;margin-bottom: 50px">
                <h5>Authors</h5>
                <p><a href="https://theo-jaunet.github.io/">Théo Jaunet</a> (<a href="https://twitter.com/jaunet_theo">@jaunet_theo</a>),
                    <a href="http://romain.vuillemot.net/">Romain
                        Vuillemot</a> (<a href="https://twitter.com/romsson">@romsson</a>) and <a
                            href="https://perso.liris.cnrs.fr/christian.wolf/">Christian Wolf </a>(<a
                            href="https://twitter.com/chriswolfvision">@chriswolfvision</a>), at LIRIS lab Lyon -
                    France.
                </p>
                This work takes place in Théo jaunet's Ph.D. which is supported by a French Ministry Fellowship and the
                <a
                        href="https://projet.liris.cnrs.fr/mi2/"> M2I project</a>,
            </div>

        </div>
    </div>

</div>

<script>
    const data = fakedata(200);

    let idSel = [];


    const proj = d3.select("#proj");

    const cirhov = proj.append("circle")
        .attr("id", "projHov")
        .attr("stroke", "#333333")
        .attr("stroke-width", "1")
        .attr("fill", "none")
        .attr("r", "24");
    drawPoints(data, proj);
    drawElements(data, d3.select("#loc"));


    let elements = proj.selectAll(".projDot");

    proj.on('mousemove', function () {
        const coords = d3.mouse(proj.node());
        cirhov.transition().duration(25).attr("transform", "translate(" + coords[0] + ", " + coords[1] + ")")


        let inside = elements.filter(d => {
            return euclidian_dist([proj_xscacle(d.px1), proj_yscacle(d.py1)], coords) < 25
        });

        inside.transition().duration(5).attr("fill", "red");

        elements.filter(d => {
            return euclidian_dist([proj_xscacle(d.px1), proj_yscacle(d.py1)], coords) > 24
        }).transition().duration(5).attr("fill", "black");


        elements.each((d) => {

                // console.log(d);
                if (euclidian_dist([proj_xscacle(d.px1), proj_yscacle(d.py1)], coords) < 25) {

                    if (!idSel.includes(d.id)) {
                        const orr = -90 + (Math.atan2(proj_yscacle(d.py1) - proj_yscacle(d.py2), proj_xscacle(d.px1) - proj_xscacle(d.px2)) * (180 / Math.PI));

                        proj.append("path")
                            .attr("class", "tbrm")
                            // .style("transform-origin", "50% 50%")
                            .attr("num", d.id)
                            .attr("fill", "steelblue")
                            .attr("d", "m 20 20 a -6 6 7 0 1 14 0 l -7 23 l -7 -23")
                            .attr("transform", "rotate(" + (orr) + " "+(proj_xscacle(d.px2)-2)+" "+(proj_yscacle(d.py2)-2)+") translate(" + (proj_xscacle(d.px2)-16) + "," + (proj_yscacle(d.py2)-16) + ")  scale(0.5) ")
                            // .attr("transform", "rotate(180 64 62) translate(50 50) scale(0.5)")

                        idSel.push(d.id)

                        let tpath = proj.append("line")
                            .attr("class", "tbrm")
                            .attr("num", d.id)
                            .attr("x1", proj_xscacle(d.px1))
                            .attr("y1", proj_yscacle(d.py1))
                            .attr("x2", proj_xscacle(d.px2))
                            .attr("y2", proj_yscacle(d.py2))
                            .attr('stroke', 'steelblue')
                            .style('stroke-width', '3px')

                        let totalLength = tpath.node().getTotalLength();

                        tpath.attr("stroke-dasharray", totalLength + " " + totalLength)
                            .attr("stroke-dashoffset", totalLength)
                            .transition()
                            .duration(500)
                            .attr("stroke-dashoffset", 0)

                    }

                } else {
                    let tid = idSel.indexOf(d.id);
                    if (tid) {
                        idSel.splice(tid)
                        d3.selectAll('.tbrm[num="' + d.id + '"]').remove()

                    }

                }
            }
        )
    });


    // $("#proj").on("mousemove", function (e) {
    //
    //     // const coords = d3.mouse(this)
    //
    //     console.log(d3.event.pageX);
    //     // proj
    //
    //
    // })


</script>



</body>
</html>
